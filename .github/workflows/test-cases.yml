on:
  workflow_dispatch:
  push:

name: Test Cases

env:
  P4PORT: ${{ secrets.P4PORT }}
    
jobs:
  test-cases-01:
    runs-on: ubuntu-latest
    name: test case 01
    env:
      P4USER: ${{ secrets.P4USER }}

    steps:
      - name: Checkout
        uses: actions/checkout@v2

      - name: p4 setup
        uses: ./
        id: setup
        with:
          command: setup
          p4_version: 21.2

      - name: p4 login
        uses: ./ # Uses the action in the root directory
        id: login
        with:
          command: login
          global_options: "-p ${{ secrets.P4PORT }} -u ${{ secrets.P4USER }}"
        env:
          P4PASSWD: ${{ secrets.P4PASSWD }}

      - name: p4 depots
        uses: ./
        id: depots
        with:
          command: depots

      - name: p4 client
        uses: ./
        id: client
        with:
          command: client
          arguments: -i

          spec: |
            Client:	github-actions-p4

            Owner: ${{ secrets.P4USER }}

            Description:
              Created by ${{ secrets.P4USER }}.

            Root:	/tmp

            Options:	noallwrite noclobber nocompress unlocked modtime rmdir

            SubmitOptions:	leaveunchanged

            LineEnd:	local

            View:
              //guest/perforce_software/sdp/... //github-actions-p4/guest/perforce_software/sdp/...

      - name: p4 sync
        uses: ./
        id: sync
        env:
          P4CLIENT: github-actions-p4
        with:
          command: sync
          arguments: -f
